#N canvas 304 152 555 666 10;
#X obj 1 0 cnv 15 552 40 empty \$0-pddp.cnv.header key-estimate 3 12
0 18 -204280 -1 0;
#X msg 320 182 read \$1;
#X msg 254 178 flush;
#X obj 281 87 openpanel;
#X obj 281 68 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144 -1
-1;
#X obj 254 206 midi-player;
#X obj 111 182 makenote 127 500;
#X msg 111 157 \$1 127;
#X obj 111 135 random 12;
#X obj 111 110 metro 1000;
#X obj 111 89 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X floatatom 204 155 5 0 0 0 - - -, f 5;
#X floatatom 168 90 5 0 0 0 - - -, f 5;
#X obj 183 208 pack;
#X obj 183 344 print key;
#X obj 1 631 cnv 15 552 21 empty \$0-pddp.cnv.footer empty 20 12 0
14 -228856 -66577 0;
#X obj 1 382 cnv 3 550 3 empty \$0-pddp.cnv.inlets inlets 8 12 0 13
-228856 -1 0;
#X obj 1 460 cnv 3 550 3 empty \$0-pddp.cnv.outlets outlets 8 12 0
13 -228856 -1 0;
#X obj 1 540 cnv 3 550 3 empty \$0-pddp.cnv.argument arguments 8 12
0 13 -228856 -1 0;
#X obj 79 391 cnv 17 3 65 empty \$0-pddp.cnv.let.0 0 5 9 0 16 -228856
-162280 0;
#X text 335 632 angelfaraldo@gmail.com \, 2015-2016;
#X text 99 390 list;
#X obj 354 344 print keyID;
#X obj 25 67 notein;
#X obj 25 92 pack;
#X text 23 48 Enter standard midi in \,;
#X text 110 67 generate random live input \,;
#X text 300 65 or load a midi file.;
#X text 320 251 bang to reset the key estimator;
#X obj 281 110 t b b s;
#X text 2 23 estimates key of incoming midi data with profile matching
;
#X obj 300 252 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X msg 205 238 \$2 \$3;
#X text 169 588 - time window for key estimation (all weights apply).
;
#X text 82 588 2) float;
#X text 82 568 1) symbol;
#X obj 79 471 cnv 17 3 65 empty \$0-pddp.cnv.let.0 0 5 9 0 16 -228856
-162280 0;
#X text 99 470 symbol;
#X obj 79 501 cnv 17 3 17 empty \$0-pddp.cnv.let.0 1 5 9 0 16 -228856
-162280 0;
#X text 169 498 - estimated key as integer (0-11 = major \, 12-23 minor).
;
#X text 169 468 - estimated key as symbol.;
#X text 169 440 - a bang resets the key estimation algorithm.;
#X text 99 440 bang;
#N canvas 854 309 545 423 advanced-options 0;
#X msg 51 99 durw \$1;
#X msg 61 129 velw \$1;
#X msg 71 159 timew \$1;
#X msg 30 39 timelenght \$1;
#X floatatom 30 19 5 0 0 0 - - -, f 5;
#X text 139 23 you can set dinamically the time window over which incoming
notes are taken into account for tonality estimation.;
#X text 139 72 WEIGTHS;
#X text 140 91 The algorithm has weights for different parameters that
affect the key estimation process \, namely the duration and velocity
of the notes played \, and an exponential decay that makes that notes
distant in time \, affect less than notes recently played. You could
change the factor of any of these parameters with the methods durw
\, velw and timew.;
#X msg 96 266 profile temperley;
#X text 95 195 additionally \, you could change the tonality profile
chosen. However \, the tonality profile must be "declared" in the key-profile.txt
\, otherwhise an exception will be thrown.;
#X msg 96 289 profile edma;
#X msg 96 314 profile wtk;
#X msg 96 243 profile krumhansl;
#X obj 31 385 s settings;
#X msg 96 339 profile diatonic;
#X text 210 242 pop music;
#X text 210 265 western classical music;
#X text 180 288 electronic dance music;
#X text 178 315 based on Bach's Well Tempered Klavier;
#X text 202 340 diatonic scales \, binary.;
#X connect 0 0 13 0;
#X connect 1 0 13 0;
#X connect 2 0 13 0;
#X connect 3 0 13 0;
#X connect 4 0 3 0;
#X connect 8 0 13 0;
#X connect 10 0 13 0;
#X connect 11 0 13 0;
#X connect 12 0 13 0;
#X connect 14 0 13 0;
#X restore 399 131 pd advanced-options;
#X text 82 608 3) float;
#X obj 254 157 until;
#X msg 254 135 4;
#X obj 259 295 r settings;
#N canvas 189 264 582 354 output-settings 1;
#X text 21 10 (default);
#X obj 22 307 s settings;
#X msg 21 31 output 0;
#X text 87 28 output mode 0 returns a new key estimate after a new
note is added into the estimation window. It can be used to estimate
continuosly live input.;
#X text 181 97 output mode 1 returns key estimates at constant intervals
set by the user via the method refresh followed by a value in miliseconds.
;
#X msg 42 101 output 1 \, refresh 500;
#X msg 72 221 estimate;
#X text 186 177 output mode 2 returns a key estimation only when requested
by the user. This can be useful to analyse complete midi files or fragments.
;
#X msg 62 191 output 2 \, estimate;
#X msg 52 131 refresh 3000;
#X connect 2 0 1 0;
#X connect 5 0 1 0;
#X connect 6 0 1 0;
#X connect 8 0 1 0;
#X connect 9 0 1 0;
#X restore 399 152 pd output-settings;
#X text 169 608 - output mode (see output-settings subpatch for help).
;
#X text 169 390 - lists starting with float are interpreted as note+velocity
midi pairs. lists starting with a keyword affect different parameters
of the algorithm.;
#X text 99 500 float;
#X text 17 246 see also:;
#X text 169 568 - key template to be used as model.;
#X obj 17 261 pddp/helplink key-profiles;
#X obj 7 632 pddp/pddplink https://github.com/angelfaraldo/pd-symbolic
;
#X obj 183 321 key-estimate krumhansl 10000 0;
#X connect 1 0 5 0;
#X connect 2 0 5 0;
#X connect 3 0 29 0;
#X connect 4 0 3 0;
#X connect 5 1 32 0;
#X connect 6 0 13 0;
#X connect 6 1 13 1;
#X connect 7 0 6 0;
#X connect 8 0 7 0;
#X connect 9 0 8 0;
#X connect 10 0 9 0;
#X connect 11 0 6 2;
#X connect 12 0 9 1;
#X connect 13 0 56 0;
#X connect 23 0 24 0;
#X connect 23 1 24 1;
#X connect 24 0 56 0;
#X connect 29 0 46 0;
#X connect 29 1 31 0;
#X connect 29 2 1 0;
#X connect 31 0 56 0;
#X connect 32 0 56 0;
#X connect 45 0 2 0;
#X connect 46 0 45 0;
#X connect 47 0 56 0;
#X connect 56 0 14 0;
#X connect 56 1 22 0;
